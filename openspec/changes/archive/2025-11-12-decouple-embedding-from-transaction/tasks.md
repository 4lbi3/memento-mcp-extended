# Implementation Tasks

## 1. Code Modification

- [ ] 1.1 Remove synchronous embedding generation from `Neo4jStorageProvider.createEntities` (lines 639-668)
  - Remove the entire conditional block that calls `this.embeddingService.generateEmbedding()`
  - Remove the `embedding` parameter from entity creation
  - Remove embedding-related logging in this method
- [ ] 1.2 Update entity creation query to not include embedding field (lines 686-701)
  - Remove `embedding: $embedding` from CREATE query parameters
  - Remove `embedding` from the query itself
- [ ] 1.3 Verify `KnowledgeGraphManager.createEntities` still schedules jobs correctly (lines 467-470)
  - Confirm job scheduling happens after storage provider call
  - No changes needed - already correct

## 2. Testing

- [ ] 2.1 Update existing tests for `Neo4jStorageProvider.createEntities`
  - Remove expectations for synchronous embedding generation
  - Verify entities are created without embeddings
- [ ] 2.2 Verify integration tests for `KnowledgeGraphManager`
  - Confirm job scheduling works correctly
  - Verify embeddings are generated asynchronously via job queue
- [ ] 2.3 Add performance regression test
  - Measure transaction duration for creating 10 entities
  - Assert transaction completes in <200ms (vs previous ~20s)

## 3. Documentation

- [ ] 3.1 Update code comments in `Neo4jStorageProvider.createEntities`
  - Document that embeddings are handled asynchronously
  - Reference the job manager for embedding generation
- [ ] 3.2 Update CHANGELOG.md
  - Document performance improvement
  - Note that embeddings are now eventually consistent

## 4. Validation

- [ ] 4.1 Run `openspec validate decouple-embedding-from-transaction --strict`
- [ ] 4.2 Run full test suite: `npm test`
- [ ] 4.3 Run integration tests with Neo4j: `npm run test:integration`
- [ ] 4.4 Manual verification:
  - Create 20 entities and verify transaction completes quickly
  - Verify job queue receives 20 jobs
  - Verify embeddings are generated by worker
  - Verify semantic search works after jobs complete
